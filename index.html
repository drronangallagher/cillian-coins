<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UK Coin Maths Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #eef2f7, #d9e2ec);
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

#app {
    background: #ffffff;
    max-width: 900px;
    width: 100%;
    border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    padding: 24px 20px 28px 20px;
    text-align: center;
}

h1 {
    color: #2c3e50;
    margin-top: 0;
}

#controls {
    margin-bottom: 18px;
}

button {
    font-size: 15px;
    padding: 8px 12px;
    margin: 4px;
    cursor: pointer;
    border-radius: 8px;
    border: 1px solid #ccd6e0;
    background: #f7f9fc;
}

button:hover { background: #eef3f8; }
button:disabled { cursor: not-allowed; opacity: 0.6; }

#question {
    font-size: 22px;
    font-weight: bold;
    margin: 14px 0;
}

#coins {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 6px;
    margin: 18px 0;
}

.coin {
    width: 72px;
    height: 72px;
    margin: 6px;
}

#dividerSymbol {
    font-size: 26px;
    font-weight: bold;
    color: #51606f;
    margin: 0 6px;
}

#answerRow {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
}

#answerBox {
    display: inline-flex;
    align-items: center;
    font-size: 18px;
}

#prefix, #suffix {
    font-size: 22px;
    margin: 0 6px;
    min-width: 20px;
    text-align: center;
}

input {
    font-size: 18px;
    padding: 6px;
    width: 160px;
    text-align: center;
    border-radius: 6px;
    border: 1px solid #cfd8e3;
}

#feedback {
    font-size: 20px;
    margin-top: 12px;
    min-height: 24px;
}

#solutionWrap {
    margin-top: 12px;
    display: none;
}

#solutionCard {
    background: #f7f9fc;
    border: 1px solid #dde6f0;
    border-radius: 10px;
    padding: 14px 14px;
    max-width: 820px;
    margin: 0 auto;
    text-align: left;
}

#solutionTitle {
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 8px;
}

#solution {
    font-size: 18px;
    white-space: pre-line;
    color: #34495e;
    line-height: 1.4;
}

#nextBtnWrap {
    margin-top: 12px;
    text-align: center;
}

#nextBtn {
    background: #e9f5ff;
    border: 1px solid #bcdfff;
}

#nextBtn:hover { background: #dff0ff; }

#stats {
    font-size: 18px;
    margin-top: 14px;
}

#timer {
    font-size: 18px;
    margin-top: 8px;
}

#trophy {
    font-size: 64px;
    display: none;
    margin-top: 14px;
}
</style>
</head>

<body>
<div id="app">

<h1>UK Coin Maths</h1>

<div id="controls">
    <button id="modeBtn" onclick="toggleMode()">Mode: <span id="modeLabel">Addition</span></button>
    <button id="currencyBtn" onclick="toggleCurrency()">Answer in: <span id="currencyLabel">pence</span></button>
    <button id="timerBtn" onclick="toggleTimer()">Timer: <span id="timerLabel">Off</span></button>
    <button id="resetBtn" onclick="resetGame()">Reset</button>
</div>

<div id="question"></div>
<div id="coins"></div>

<div id="answerRow">
    <div id="answerBox">
        <span id="prefix"></span>
        <input type="number" id="answer" inputmode="numeric">
        <span id="suffix"></span>
    </div>
    <button id="checkBtn" onclick="checkAnswer()">Check</button>
</div>

<div id="feedback"></div>

<div id="solutionWrap">
    <div id="solutionCard">
        <div id="solutionTitle">Worked solution - best method</div>
        <div id="solution"></div>
        <div id="nextBtnWrap">
            <button id="nextBtn" onclick="acknowledgeSolution()">I Got It! - Next Question Please</button>
        </div>
    </div>
</div>

<div id="stats">
    Streak: <span id="streak">0</span> |
    Best: <span id="best">0</span>
</div>

<div id="timer"></div>
<div id="trophy">üèÜ</div>

<script>
const coins = [
    { value: 1, img: "coins/1p.jpg" },
    { value: 2, img: "coins/2p.jpg" },
    { value: 5, img: "coins/5p.jpg" },
    { value: 10, img: "coins/10p.jpg" },
    { value: 20, img: "coins/20p.png" },
    { value: 50, img: "coins/50p.jpg" },
    { value: 100, img: "coins/1pound.jpg" },
    { value: 200, img: "coins/2pound.png" }
];

let modes = ["addition", "multiplication", "mixed", "subdivision", "random"];
let modeIndex = 0;

let currency = "pence";
let timerOn = false;

let currentCoins = [];
let correctTotal = 0;
let correctCount = 0;
let answerType = "money";

let streak = 0;
let best = 0;

let lockedOnSolution = false;
let timerInterval = null;
let timeLeft = 0;

/* ---------- Utilities ---------- */

function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function formatValue(pence) {
    return pence >= 100 ? "¬£" + (pence / 100) : pence + "p";
}

function penceToPoundsString(pence) {
    return "¬£" + (pence / 100).toFixed(2);
}

function updateAnswerAffixes() {
    if (answerType !== "money") {
        prefix.textContent = "";
        suffix.textContent = "";
        currencyBtn.disabled = true;
        return;
    }
    currencyBtn.disabled = false;
    prefix.textContent = currency === "pounds" ? "¬£" : "";
    suffix.textContent = currency === "pence" ? "p" : "";
}

/* ---------- Rendering ---------- */

function renderCoins(showDivider=false) {
    coinsDiv.innerHTML = "";
    if (!showDivider) {
        currentCoins.forEach(c => {
            const img = document.createElement("img");
            img.src = c.img;
            img.className = "coin";
            coinsDiv.appendChild(img);
        });
        return;
    }

    const imgL = document.createElement("img");
    imgL.src = currentCoins[0].img;
    imgL.className = "coin";
    coinsDiv.appendChild(imgL);

    const div = document.createElement("div");
    div.id = "dividerSymbol";
    div.textContent = "in";
    coinsDiv.appendChild(div);

    const imgR = document.createElement("img");
    imgR.src = currentCoins[1].img;
    imgR.className = "coin";
    coinsDiv.appendChild(imgR);
}

/* ---------- Teaching Solution Builders ---------- */

function buildCoinCounts() {
    const map = new Map();
    currentCoins.forEach(c => map.set(c.value, (map.get(c.value) || 0) + 1));
    return map;
}

function buildMoneyTeachingSolution() {
    const counts = buildCoinCounts();
    const values = Array.from(counts.keys()).sort((a,b)=>b-a);
    let running = 0;
    const lines = [];

    lines.push("Step 1: Group the same coins");
    lines.push(values.map(v => {
        const n = counts.get(v);
        return n > 1 ? n + " √ó " + formatValue(v) : formatValue(v);
    }).join(" + "));
    lines.push("");

    lines.push("Step 2: Do any easy multiplication");
    values.forEach(v => {
        const n = counts.get(v);
        if (n > 1) lines.push(n + " √ó " + v + "p = " + (n*v) + "p");
    });
    lines.push("");

    lines.push("Step 3: Add from biggest to smallest (running total)");
    values.forEach(v => {
        const n = counts.get(v);
        const subtotal = n * v;
        running += subtotal;
        lines.push((n>1 ? n+" √ó ":"") + v + "p = " + subtotal + "p, total = " + running + "p");
    });
    lines.push("");

    lines.push("Final answer: " + correctTotal + "p");
    lines.push("That is " + penceToPoundsString(correctTotal));
    return lines.join("\n");
}

function buildSubdivisionTeachingSolution() {
    const lines = [];
    if (currentCoins.length === 2) {
        const small = currentCoins[0].value;
        const large = currentCoins[1].value;
        const answer = Math.round(large / small);
        lines.push("Step 1: Write both values in pence");
        lines.push(large + "p and " + small + "p");
        lines.push("");
        lines.push("Step 2: Divide");
        lines.push(large + "p √∑ " + small + "p = " + answer);
        lines.push("");
        lines.push("Step 3: Quick check");
        lines.push(answer + " √ó " + small + "p = " + (answer*small) + "p");
        lines.push("");
        lines.push("Final answer: " + correctCount);
    } else {
        const total = currentCoins.reduce((a,c)=>a+c.value,0);
        lines.push("Step 1: Find the total");
        lines.push(currentCoins.map(c=>formatValue(c.value)).join(" + "));
        lines.push("Total = " + total + "p");
        lines.push("");
        lines.push("Step 2: Divide by the coin value");
        lines.push("Total √∑ coin value");
        lines.push("");
        lines.push("Step 3: Quick check");
        lines.push("Answer √ó coin value = total");
        lines.push("");
        lines.push("Final answer: " + correctCount);
    }
    return lines.join("\n");
}

/* ---------- Problem Generators ---------- */

function generateAddition() {
    answerType = "money";
    currentCoins = [];
    correctTotal = 0;
    const count = randomInt(2,4);
    for (let i=0;i<count;i++) {
        const c = coins[randomInt(0, coins.length-1)];
        currentCoins.push(c);
        correctTotal += c.value;
    }
    question.textContent = "Add up the coins";
    renderCoins();
}

function generateMultiplication() {
    answerType = "money";
    currentCoins = [];
    const c = coins[randomInt(0, coins.length-1)];
    const n = randomInt(2,4);
    for (let i=0;i<n;i++) currentCoins.push(c);
    correctTotal = c.value * n;
    question.textContent = n + " √ó " + formatValue(c.value);
    renderCoins();
}

function generateMixed() {
    answerType = "money";
    currentCoins = [];
    correctTotal = 0;
    const base = coins[randomInt(0, coins.length-1)];
    const n = randomInt(2,4);
    for (let i=0;i<n;i++) {
        currentCoins.push(base);
        correctTotal += base.value;
    }
    let expr = "(" + n + " √ó " + formatValue(base.value) + ")";
    const extras = randomInt(1,2);
    for (let i=0;i<extras;i++) {
        let extra;
        do { extra = coins[randomInt(0, coins.length-1)]; }
        while (extra.value === base.value);
        currentCoins.push(extra);
        correctTotal += extra.value;
        expr += " + " + formatValue(extra.value);
    }
    question.textContent = expr;
    renderCoins();
}

function generateSubdivision() {
    answerType = "count";
    currentCoins = [];
    const smallVals = [1,2,5,10,20,50];
    const largeVals = [10,20,50,100,200];
    let small, large;
    do {
        small = smallVals[randomInt(0, smallVals.length-1)];
        large = largeVals[randomInt(0, largeVals.length-1)];
    } while (large <= small || large % small !== 0);

    const smallCoin = coins.find(c=>c.value===small);
    const largeCoin = coins.find(c=>c.value===large);

    currentCoins = [smallCoin, largeCoin];
    correctCount = large / small;
    question.textContent = "How many " + formatValue(small) + " coins are in " + formatValue(large) + "?";
    renderCoins(true);
}

/* ---------- Main Flow ---------- */

function generateQuestion() {
    if (lockedOnSolution) return;
    solutionWrap.style.display = "none";
    feedback.textContent = "";
    answer.value = "";

    let mode = modes[modeIndex];
    if (mode === "random") {
        mode = ["addition","multiplication","mixed","subdivision"][randomInt(0,3)];
    }

    if (mode === "addition") generateAddition();
    if (mode === "multiplication") generateMultiplication();
    if (mode === "mixed") generateMixed();
    if (mode === "subdivision") generateSubdivision();

    updateAnswerAffixes();
}

function handleWrong() {
    lockedOnSolution = true;
    feedback.textContent = "Not quite. Here is the best way to work it out:";
    solution.textContent = (answerType==="money")
        ? buildMoneyTeachingSolution()
        : buildSubdivisionTeachingSolution();
    solutionWrap.style.display = "block";
    streak = 0;
    updateStats();
}

function checkAnswer() {
    if (lockedOnSolution) return;
    const raw = parseFloat(answer.value);
    if (isNaN(raw)) return;

    if (answerType === "count") {
        if (Math.round(raw) === correctCount) {
            streak++; best=Math.max(best,streak);
            feedback.textContent="Correct! üéâ";
            updateStats();
            setTimeout(generateQuestion,700);
        } else handleWrong();
        return;
    }

    const userPence = currency==="pounds" ? Math.round(raw*100) : Math.round(raw);
    if (userPence === correctTotal) {
        streak++; best=Math.max(best,streak);
        feedback.textContent="Correct! üéâ";
        updateStats();
        setTimeout(generateQuestion,700);
    } else handleWrong();
}

function acknowledgeSolution() {
    lockedOnSolution = false;
    solutionWrap.style.display = "none";
    generateQuestion();
}

function toggleMode() {
    if (lockedOnSolution) return;
    modeIndex = (modeIndex+1)%modes.length;
    modeLabel.textContent = modes[modeIndex][0].toUpperCase()+modes[modeIndex].slice(1);
    generateQuestion();
}

function toggleCurrency() {
    if (answerType!=="money") return;
    currency = currency==="pence" ? "pounds" : "pence";
    currencyLabel.textContent = currency;
    updateAnswerAffixes();
}

function toggleTimer() {
    timerOn = !timerOn;
    timerLabel.textContent = timerOn ? "On" : "Off";
}

function resetGame() {
    streak = 0; best = 0;
    updateStats();
    lockedOnSolution = false;
    generateQuestion();
}

function updateStats() {
    streakSpan.textContent = streak;
    bestSpan.textContent = best;
    trophy.style.display = streak>=10 ? "block" : "none";
}

/* ---------- DOM refs ---------- */

const coinsDiv = document.getElementById("coins");
const question = document.getElementById("question");
const answer = document.getElementById("answer");
const feedback = document.getElementById("feedback");
const solution = document.getElementById("solution");
const solutionWrap = document.getElementById("solutionWrap");
const prefix = document.getElementById("prefix");
const suffix = document.getElementById("suffix");
const modeLabel = document.getElementById("modeLabel");
const currencyLabel = document.getElementById("currencyLabel");
const timerLabel = document.getElementById("timerLabel");
const currencyBtn = document.getElementById("currencyBtn");
const streakSpan = document.getElementById("streak");
const bestSpan = document.getElementById("best");
const trophy = document.getElementById("trophy");

/* ---------- Init ---------- */

modeLabel.textContent = "Addition";
currencyLabel.textContent = currency;
timerLabel.textContent = "Off";
updateAnswerAffixes();
generateQuestion();
</script>

</div>
</body>
</html>
