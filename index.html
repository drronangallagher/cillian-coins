<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cillian's Coin GOAT Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #eef2f7, #d9e2ec);
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

#app {
    background: #ffffff;
    max-width: 720px;
    width: 100%;
    border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    padding: 24px 20px 28px 20px;
    text-align: center;
}

h1 {
    color: #2c3e50;
    margin-top: 0;
}

#controls {
    margin-bottom: 18px;
}

button {
    font-size: 15px;
    padding: 8px 12px;
    margin: 4px;
    cursor: pointer;
    border-radius: 8px;
    border: 1px solid #ccd6e0;
    background: #f7f9fc;
}

button:hover {
    background: #eef3f8;
}

#question {
    font-size: 22px;
    font-weight: bold;
    margin: 14px 0;
}

#coins {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin: 18px 0;
}

.coin {
    width: 72px;
    height: 72px;
    margin: 8px;
}

#answerBox {
    display: inline-flex;
    align-items: center;
    font-size: 18px;
    margin-top: 10px;
}

#prefix, #suffix {
    font-size: 22px;
    margin: 0 6px;
}

input {
    font-size: 18px;
    padding: 6px;
    width: 120px;
    text-align: center;
    border-radius: 6px;
    border: 1px solid #cfd8e3;
}

#feedback {
    font-size: 20px;
    margin-top: 12px;
    min-height: 24px;
}

#solution {
    font-size: 18px;
    margin-top: 10px;
    white-space: pre-line;
    color: #34495e;
}

#stats {
    font-size: 18px;
    margin-top: 14px;
}

#timer {
    font-size: 18px;
    margin-top: 8px;
}

#trophy {
    font-size: 64px;
    display: none;
    margin-top: 14px;
}
</style>
</head>

<body>

<div id="app">

<h1>Cillian's Coin GOAT Game</h1>

<div id="controls">
    <button onclick="toggleMode()">Mode: <span id="modeLabel">Addition</span></button>
    <button onclick="toggleCurrency()">Answer in: <span id="currencyLabel">pence</span></button>
    <button onclick="toggleTimer()">Timer: <span id="timerLabel">Off</span></button>
    <button onclick="resetGame()">Reset</button>
</div>

<div id="question"></div>
<div id="coins"></div>

<div id="answerBox">
    <span id="prefix"></span>
    <input type="number" id="answer">
    <span id="suffix"></span>
    <button onclick="checkAnswer()">Check</button>
</div>

<div id="feedback"></div>
<div id="solution"></div>

<div id="stats">
    Streak: <span id="streak">0</span> |
    Best: <span id="best">0</span>
</div>

<div id="timer"></div>
<div id="trophy">üèÜ</div>

<audio id="correctSound">
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=">
</audio>

<audio id="wrongSound">
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=">
</audio>

<script>
const coins = [
    { value: 1, img: "coins/1p.jpg" },
    { value: 2, img: "coins/2p.jpg" },
    { value: 5, img: "coins/5p.jpg" },
    { value: 10, img: "coins/10p.jpg" },
    { value: 20, img: "coins/20p.png" },
    { value: 50, img: "coins/50p.jpg" },
    { value: 100, img: "coins/1pound.jpg" },
    { value: 200, img: "coins/2pound.png" }
];

let modes = ["addition", "multiplication", "mixed"];
let modeIndex = 0;
let currency = "pence";
let timerOn = false;

let currentCoins = [];
let steps = [];
let correctTotal = 0;

let streak = 0;
let best = 0;

let timeLeft = 0;
let timerInterval = null;

function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function toggleMode() {
    modeIndex = (modeIndex + 1) % modes.length;
    document.getElementById("modeLabel").textContent =
        modes[modeIndex].charAt(0).toUpperCase() + modes[modeIndex].slice(1);
    generateQuestion();
}

function toggleCurrency() {
    currency = currency === "pence" ? "pounds" : "pence";
    document.getElementById("currencyLabel").textContent = currency;
    updateAnswerAffixes();
}

function toggleTimer() {
    timerOn = !timerOn;
    document.getElementById("timerLabel").textContent = timerOn ? "On" : "Off";
    generateQuestion();
}

function resetGame() {
    streak = 0;
    best = 0;
    document.getElementById("streak").textContent = 0;
    document.getElementById("best").textContent = 0;
    document.getElementById("trophy").style.display = "none";
    generateQuestion();
}

function generateQuestion() {
    clearInterval(timerInterval);
    document.getElementById("timer").textContent = "";
    document.getElementById("feedback").textContent = "";
    document.getElementById("solution").textContent = "";
    document.getElementById("answer").value = "";
    currentCoins = [];
    steps = [];
    correctTotal = 0;

    const mode = modes[modeIndex];

    if (mode === "addition") {
        const count = randomInt(2, 4);
        let parts = [];
        for (let i = 0; i < count; i++) {
            const c = coins[randomInt(0, coins.length - 1)];
            currentCoins.push(c);
            correctTotal += c.value;
            parts.push(formatValue(c.value));
        }
        steps.push(parts.join(" + "));
    }

    if (mode === "multiplication") {
        const coin = coins[randomInt(0, coins.length - 1)];
        const count = randomInt(2, 4);
        for (let i = 0; i < count; i++) currentCoins.push(coin);
        correctTotal = coin.value * count;
        steps.push(count + " √ó " + formatValue(coin.value));
        steps.push((count * coin.value) + "p");
    }

    if (mode === "mixed") {
        const base = coins[randomInt(0, coins.length - 1)];
        const multCount = randomInt(2, 4);

        for (let i = 0; i < multCount; i++) {
            currentCoins.push(base);
            correctTotal += base.value;
        }

        let expression = "(" + multCount + " √ó " + formatValue(base.value) + ")";
        let expanded = (multCount * base.value) + "p";

        const extras = randomInt(1, 2);
        for (let i = 0; i < extras; i++) {
            const e = coins[randomInt(0, coins.length - 1)];
            currentCoins.push(e);
            correctTotal += e.value;
            expression += " + " + formatValue(e.value);
            expanded += " + " + e.value + "p";
        }

        steps.push(expression);
        steps.push(expanded);
    }

    steps.push(correctTotal + "p");

    document.getElementById("question").textContent = steps[0];
    renderCoins();
    updateAnswerAffixes();

    if (timerOn) startTimer();
}

function renderCoins() {
    const c = document.getElementById("coins");
    c.innerHTML = "";
    currentCoins.forEach(x => {
        const img = document.createElement("img");
        img.src = x.img;
        img.className = "coin";
        c.appendChild(img);
    });
}

function formatValue(pence) {
    return pence >= 100 ? "¬£" + (pence / 100) : pence + "p";
}

function updateAnswerAffixes() {
    document.getElementById("prefix").textContent = currency === "pounds" ? "¬£" : "";
    document.getElementById("suffix").textContent = currency === "pence" ? "p" : "";
}

function startTimer() {
    timeLeft = 10;
    document.getElementById("timer").textContent = "Time left: " + timeLeft;
    timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").textContent = "Time left: " + timeLeft;
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            handleWrong();
        }
    }, 1000);
}

function checkAnswer() {
    let input = parseFloat(document.getElementById("answer").value);
    if (isNaN(input)) return;

    let answerInPence = currency === "pounds"
        ? Math.round(input * 100)
        : Math.round(input);

    if (answerInPence === correctTotal) {
        document.getElementById("correctSound").play();
        streak++;
        best = Math.max(best, streak);
        document.getElementById("feedback").textContent = "Correct! üéâ";
        document.getElementById("solution").textContent = "";
        updateStats();
        setTimeout(generateQuestion, 1000);
    } else {
        handleWrong();
    }
}

function handleWrong() {
    document.getElementById("wrongSound").play();
    document.getElementById("feedback").textContent = "Not quite. Here is how to work it out:";
    document.getElementById("solution").textContent =
        steps.map((s, i) => (i === 0 ? s : "= " + s)).join("\n");
    streak = 0;
    updateStats();
    setTimeout(generateQuestion, 2500);
}

function updateStats() {
    document.getElementById("streak").textContent = streak;
    document.getElementById("best").textContent = best;
    document.getElementById("trophy").style.display =
        streak >= 10 ? "block" : "none";
}

generateQuestion();
</script>

</div>
</body>
</html>
